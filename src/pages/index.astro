---
import { SHEET_TABS } from "@/config/sheets";
import { BOOLEAN_FIELDS } from "@/config/constants";
import { loadTabData } from "@/lib/dataLoader";
import FilterBar from "@/components/FilterBar.astro";
import TabSection from "@/components/TabSection.astro";
import NetworkView from "@/components/NetworkView.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";

const tabData = loadTabData(SHEET_TABS);
---

<BaseLayout
  title="[Source, Code, Print]"
  showViewToggle={true}
  noMarkdown={true}
>
  <div id="gridView">
    <FilterBar tags={BOOLEAN_FIELDS} />
    {
      Object.entries(tabData).map(([tab, payload]) => (
        <TabSection
          tab={tab}
          payload={payload}
          booleanFields={BOOLEAN_FIELDS}
        />
      ))
    }
  </div>

  <NetworkView tabData={tabData} booleanFields={BOOLEAN_FIELDS} />

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const toggleButton = document.getElementById("viewToggle");
      const gridView = document.getElementById("gridView");
      const networkView = document.querySelector(".network-view");
      const toggleText = document.querySelector(".toggle-text");
      let isNetworkMode = false;

      const handleToggle = () => {
        isNetworkMode = !isNetworkMode;

        if (isNetworkMode) {
          gridView!.style.display = "none";
          networkView!.style.display = "block";
          // Lock scroll in network view
          document.body.style.overflow = "hidden";
          toggleText!.textContent = "Grid View";
          // Hide header and footer in network view
          const header = document.getElementById("siteHeader");
          if (header) header.style.display = "none";
          const footer = document.querySelector(".footer");
          if (footer) (footer as HTMLElement).style.display = "none";
        } else {
          gridView!.style.display = "block";
          networkView!.style.display = "none";
          // Restore scroll in grid view
          document.body.style.overflow = "";
          toggleText!.textContent = "Network View";
          // Show header and footer in grid view
          const header = document.getElementById("siteHeader");
          if (header) header.style.display = "";
          const footer = document.querySelector(".footer");
          if (footer) (footer as HTMLElement).style.display = "";
        }
      };

      toggleButton?.addEventListener("click", handleToggle);
      document
        .getElementById("networkToggle")
        ?.addEventListener("click", handleToggle);
    });
  </script>
</BaseLayout>
