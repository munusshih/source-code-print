---
import { SHEET_ID, SHEET_TABS } from "../config/sheets";
import { fetchSheet } from "../lib/opensheet";

export async function getStaticPaths() {
  return SHEET_TABS.map((tab) => ({
    params: { tab },
  }));
}

const { params } = Astro;
const tab = params.tab || "";
let rows: Record<string, string>[] | null = null;
let error: string | null = null;

if (tab) {
  try {
    rows = await fetchSheet(SHEET_ID, tab);
  } catch (e) {
    error = e.message || String(e);
  }
} else {
  error = "No tab provided.";
}
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Sheet Tab: {tab}</title>
  </head>
  <body>
    <h1>Tab: {tab}</h1>
    <p><a href="/">Back</a></p>
    {error && <p class="error">{error}</p>}
    {rows && rows.length === 0 && <p>No rows.</p>}
    {
      rows && rows.length > 0 && (
        <table>
          <thead>
            <tr>
              {Object.keys(rows[0]).map((col) => (
                <th>{col}</th>
              ))}
            </tr>
          </thead>
          <tbody>
            {rows.map((row) => (
              <tr>
                {Object.values(row).map((val) => (
                  <td>{val}</td>
                ))}
              </tr>
            ))}
          </tbody>
        </table>
      )
    }
  </body>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 2rem;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 1rem;
    }
    th,
    td {
      border: 1px solid #ddd;
      padding: 0.5rem;
      font-size: 0.85rem;
    }
    th {
      background: #f5f5f5;
      text-align: left;
    }
    tr:nth-child(even) {
      background: #fafafa;
    }
    .error {
      color: #b00020;
      font-weight: 600;
    }
  </style>
</html>
