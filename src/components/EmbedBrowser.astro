---

---

<div class="embed-backdrop" id="embedBackdrop"></div>

<div class="embed-browser" id="embedBrowser">
  <div class="embed-header">
    <div class="embed-controls">
      <button class="embed-minimize" id="embedMinimize">−</button>
      <button class="embed-fullscreen" id="embedFullscreen">□</button>
      <button class="embed-close" id="embedClose">✕</button>
    </div>
    <div class="embed-url" id="embedUrl"></div>
  </div>
  <iframe class="embed-frame" id="embedFrame"></iframe>
</div>

<div class="embed-taskbar" id="embedTaskbar">
  <button class="embed-taskbar-item" id="embedTaskbarItem">
    <span id="embedTaskbarUrl"></span>
  </button>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const embedBrowser = document.getElementById("embedBrowser");
    const embedBackdrop = document.getElementById("embedBackdrop");
    const embedFrame = document.getElementById(
      "embedFrame"
    ) as HTMLIFrameElement;
    const embedUrl = document.getElementById("embedUrl");
    const embedClose = document.getElementById("embedClose");
    const embedMinimize = document.getElementById("embedMinimize");
    const embedFullscreen = document.getElementById("embedFullscreen");
    const embedTaskbar = document.getElementById("embedTaskbar");
    const embedTaskbarItem = document.getElementById("embedTaskbarItem");
    const embedTaskbarUrl = document.getElementById("embedTaskbarUrl");

    let isFullscreen = false;
    let currentUrl = "";

    // Function to minimize browser
    const minimizeBrowser = () => {
      embedBrowser?.classList.remove("active");
      embedBackdrop?.classList.remove("active");
      embedTaskbar?.classList.add("active");
      if (embedTaskbarUrl) {
        embedTaskbarUrl.textContent = currentUrl;
      }
    };

    // Click backdrop to minimize
    embedBackdrop?.addEventListener("click", () => {
      minimizeBrowser();
    });

    // Close button handler
    embedClose?.addEventListener("click", () => {
      embedBrowser?.classList.remove("active");
      embedBackdrop?.classList.remove("active");
      embedTaskbar?.classList.remove("active");
      if (embedFrame) embedFrame.src = "";
      isFullscreen = false;
      embedBrowser?.classList.remove("fullscreen");
      currentUrl = "";
    });

    // Minimize button handler
    embedMinimize?.addEventListener("click", () => {
      minimizeBrowser();
    });

    // Taskbar item click - restore window
    embedTaskbarItem?.addEventListener("click", () => {
      embedBrowser?.classList.add("active");
      embedBackdrop?.classList.add("active");
      embedTaskbar?.classList.remove("active");
    });

    // Fullscreen toggle handler
    embedFullscreen?.addEventListener("click", () => {
      isFullscreen = !isFullscreen;
      if (isFullscreen) {
        embedBrowser?.classList.add("fullscreen");
      } else {
        embedBrowser?.classList.remove("fullscreen");
      }
    });

    // Global function to open embed browser
    (window as any).openEmbedBrowser = (url: string) => {
      if (embedFrame && embedUrl && embedBrowser) {
        currentUrl = url;
        embedFrame.src = url;
        embedUrl.textContent = url;
        embedBrowser.classList.add("active");
        embedBackdrop?.classList.add("active");
        embedTaskbar?.classList.remove("active");
      }
    };

    // Listen for clicks on all links
    document.addEventListener("click", (e) => {
      const target = e.target as HTMLElement;

      // Check if clicked element or its parent is a link
      const link = target.closest("a[href]") as HTMLAnchorElement;

      if (link && link.href) {
        // Check if it's an external link (different domain)
        const currentDomain = window.location.origin;
        const linkDomain = new URL(link.href, currentDomain).origin;

        if (linkDomain !== currentDomain) {
          // External link - open in embed browser
          e.preventDefault();
          (window as any).openEmbedBrowser(link.href);
        }
        // Internal links (same domain) will navigate normally
      }
    });
  });
</script>
