---

---

<div class="embed-backdrop" id="embedBackdrop"></div>

<div class="embed-browser" id="embedBrowser">
  <div class="embed-header">
    <div class="embed-controls">
      <button class="embed-minimize" id="embedMinimize">−</button>
      <button class="embed-fullscreen" id="embedFullscreen">□</button>
      <button class="embed-close" id="embedClose">✕</button>
    </div>
    <div class="embed-url" id="embedUrl"></div>
  </div>
  <iframe class="embed-frame" id="embedFrame"></iframe>
</div>

<div class="embed-taskbar" id="embedTaskbar">
  <button class="embed-taskbar-item" id="embedTaskbarItem">
    <span id="embedTaskbarUrl"></span>
  </button>
</div>

<style>
  .embed-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.3);
    z-index: 999;
    display: none;
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .embed-backdrop.active {
    display: block;
    opacity: 1;
  }

  .embed-browser {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80vw;
    height: 80vh;
    background: white;
    border: 4px solid var(--color-border);
    z-index: 1000;
    display: none;
    flex-direction: column;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    opacity: 0;
    transition:
      opacity 0.2s ease,
      transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .embed-browser.active {
    display: flex;
    opacity: 1;
  }

  .embed-browser.fullscreen {
    width: 100vw;
    height: 100vh;
    top: 0;
    left: 0;
    transform: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .embed-taskbar {
    position: fixed;
    bottom: 1.5rem;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    z-index: 999;
    opacity: 0;
    transition:
      opacity 0.2s ease,
      transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
  }

  .embed-taskbar.active {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
    pointer-events: auto;
  }

  .embed-taskbar-item {
    padding: 0.75rem 1.5rem;
    background: var(--color-bg);
    border: 2px solid var(--color-border);
    font-family: "Courier Prime", monospace;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.15s;
    max-width: 300px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .embed-taskbar-item:hover {
    transform: translateY(-2px);
  }

  .embed-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem 1rem;
    background: var(--color-bg);
    border-bottom: 2px solid var(--color-border);
  }

  .embed-controls {
    display: flex;
    gap: 0.5rem;
  }

  .embed-controls button {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border: 2px solid var(--color-border);
    font-weight: bold;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.15s;
    padding: 0;
    line-height: 1;
  }

  .embed-controls button:hover {
    transform: translateY(-2px);
    background: var(--color-bg);
  }

  .embed-close {
    background: var(--color-tag-bg) !important;
    color: var(--color-tag-text) !important;
  }

  .embed-close:hover {
    background: var(--color-tag-bg) !important;
  }

  .embed-url {
    flex: 1;
    font-family: "Courier Prime", monospace;
    font-size: 13px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    padding: 0.25rem 0.5rem;
    background: white;
    border: 2px solid var(--color-border);
  }

  .embed-frame {
    flex: 1;
    width: 100%;
    border: none;
    background: white;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const embedBrowser = document.getElementById("embedBrowser");
    const embedBackdrop = document.getElementById("embedBackdrop");
    const embedFrame = document.getElementById(
      "embedFrame"
    ) as HTMLIFrameElement;
    const embedUrl = document.getElementById("embedUrl");
    const embedClose = document.getElementById("embedClose");
    const embedMinimize = document.getElementById("embedMinimize");
    const embedFullscreen = document.getElementById("embedFullscreen");
    const embedTaskbar = document.getElementById("embedTaskbar");
    const embedTaskbarItem = document.getElementById("embedTaskbarItem");
    const embedTaskbarUrl = document.getElementById("embedTaskbarUrl");

    let isFullscreen = false;
    let currentUrl = "";

    // Function to minimize browser
    const minimizeBrowser = () => {
      embedBrowser?.classList.remove("active");
      embedBackdrop?.classList.remove("active");
      embedTaskbar?.classList.add("active");
      if (embedTaskbarUrl) {
        embedTaskbarUrl.textContent = currentUrl;
      }
    };

    // Click backdrop to minimize
    embedBackdrop?.addEventListener("click", () => {
      minimizeBrowser();
    });

    // Close button handler
    embedClose?.addEventListener("click", () => {
      embedBrowser?.classList.remove("active");
      embedBackdrop?.classList.remove("active");
      embedTaskbar?.classList.remove("active");
      if (embedFrame) embedFrame.src = "";
      isFullscreen = false;
      embedBrowser?.classList.remove("fullscreen");
      currentUrl = "";
    });

    // Minimize button handler
    embedMinimize?.addEventListener("click", () => {
      minimizeBrowser();
    });

    // Taskbar item click - restore window
    embedTaskbarItem?.addEventListener("click", () => {
      embedBrowser?.classList.add("active");
      embedBackdrop?.classList.add("active");
      embedTaskbar?.classList.remove("active");
    });

    // Fullscreen toggle handler
    embedFullscreen?.addEventListener("click", () => {
      isFullscreen = !isFullscreen;
      if (isFullscreen) {
        embedBrowser?.classList.add("fullscreen");
      } else {
        embedBrowser?.classList.remove("fullscreen");
      }
    });

    // Global function to open embed browser
    (window as any).openEmbedBrowser = (url: string) => {
      if (embedFrame && embedUrl && embedBrowser) {
        currentUrl = url;
        embedFrame.src = url;
        embedUrl.textContent = url;
        embedBrowser.classList.add("active");
        embedBackdrop?.classList.add("active");
        embedTaskbar?.classList.remove("active");
      }
    };

    // Listen for clicks on all links
    document.addEventListener("click", (e) => {
      const target = e.target as HTMLElement;

      // Check if clicked element or its parent is a link
      const link = target.closest("a[href]") as HTMLAnchorElement;

      if (link && link.href && link.href.startsWith("http")) {
        e.preventDefault();
        (window as any).openEmbedBrowser(link.href);
      }
    });
  });
</script>
